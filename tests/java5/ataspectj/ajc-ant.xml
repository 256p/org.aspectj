<!-- ajc-ant script, not to be used from Ant commant line - see AntSpec -->
<project name="ltw" default="javac.ltw">

    <!-- using this we can debug the forked VM -->
    <property
        name="jdwp"
        value="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005"/>

    <target name="compile:javac">
        <!-- compile only javac compilable stuff -->
        <javac destdir="${aj.sandbox}" classpathref="aj.path"
            srcdir="${basedir}"
            includes="ataspectj/*"
            debug="true">
        </javac>
    </target>

    <target name="ltw">
        <java fork="yes" classname="ataspectj.AllLTWTests" failonerror="yes">
            <classpath refid="aj.path"/>
            <!-- use META-INF/aop.xml style -->
            <classpath path="ataspectj/pathentry"/>
            <jvmarg value="-javaagent:${aj.root}/lib/test/loadtime5.jar"/>
<!--            <jvmarg line="${jdwp}"/>-->
        </java>
    </target>

    <target name="ltw.PerClauseTest">
        <java fork="yes" classname="ataspectj.PerClauseTest" failonerror="yes">
            <classpath refid="aj.path"/>
            <jvmarg value="-javaagent:${aj.root}/lib/test/loadtime5.jar"/>
            <jvmarg value="-Daj5.def=ataspectj/aop-perclausetest.xml"/>
<!--            <jvmarg line="${jdwp}"/>            -->
        </java>
    </target>

    <target name="ltw.AroundInlineMungerTest">
        <java fork="yes" classname="ataspectj.AroundInlineMungerTest" failonerror="yes">
            <classpath refid="aj.path"/>
            <jvmarg value="-javaagent:${aj.root}/lib/test/loadtime5.jar"/>
            <jvmarg value="-Daj5.def=ataspectj/aop-aroundinlinemungertest.xml"/>
            <!--<jvmarg line="${jdwp}"/>--><!-- uncomment to debug with JDWP -->
        </java>
    </target>

    <target name="ltw.AroundInlineMungerTest2">
        <java fork="yes" classname="ataspectj.AroundInlineMungerTest2" failonerror="yes">
            <classpath refid="aj.path"/>
            <jvmarg value="-javaagent:${aj.root}/lib/test/loadtime5.jar"/>
            <jvmarg value="-Daj5.def=ataspectj/aop-aroundinlinemungertest2.xml"/>
        </java>
    </target>

    <target name="ltw.DumpTest">
        <java fork="yes" classname="ataspectj.DumpTest" failonerror="yes">
            <classpath refid="aj.path"/>
            <jvmarg value="-javaagent:${aj.root}/lib/test/loadtime5.jar"/>
            <jvmarg value="-Daj5.def=ataspectj/aop-dump.xml"/>
        </java>
    </target>

    <target name="javac.ltw" depends="compile:javac, ltw"/>

    <target name="ltw.Aspect2MainTest">
        <!-- javac Aspect2 -->
        <javac destdir="${aj.sandbox}" classpathref="aj.path"
            srcdir="${basedir}"
            includes="ataspectj/ltwreweavable/Aspect2.java"
            debug="true">
        </javac>
        <delete dir="${aj.sandbox}" includes="**/Aspect1.class, **/Main.class"/>
        <java fork="yes" classname="ataspectj.ltwreweavable.Main" failonerror="yes">
            <classpath refid="aj.path"/>
            <classpath>
                <pathelement path="${aj.sandbox}/main1.jar"/>
            </classpath>
            <jvmarg value="-javaagent:${aj.root}/lib/test/loadtime5.jar"/>
            <jvmarg value="-Daj5.def=ataspectj/ltwreweavable/aop-ltwreweavable.xml"/>
        </java>

    </target>
</project>
<!DOCTYPE suite SYSTEM "../tests/ajcTestSuite.dtd"[]>

<!-- AspectJ v1.5.2 Tests -->
<suite>

    <ajc-test dir="bugs152/pr135001" title="aspect libraries and asm">
      <compile files="AbstractAspect.java" outjar="lib.jar" options="-1.5"/>
      <compile files="Foo.java,ConcreteAspect.java" classpath="lib.jar" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(void Foo.foo())' in Type 'Foo' (Foo.java:3) advised by around advice from 'ConcreteAspect' (AbstractAspect.java:5)"/>
      </compile>
      <run class="Foo">
         <stderr>
           <line text="In the advice!"/>
         </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr136258" title="stack overflow">
      <compile files="StatisticsTypeImpl.java" options="-1.5"/>
      <run class="StatisticsTypeImpl"/>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138158" title="not at withincode - 1">
      <compile files="Boo.java" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(void Boo.m())' in Type 'Boo' (Boo.java:9) advised by before advice from 'X' (Boo.java:19)"/>
      </compile>
      <run class="Boo"/>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138158" title="not at within - 3">
      <compile files="Doo.java" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(void java.io.PrintStream.println(java.lang.String))' in Type 'Soo' (Doo.java:20) advised by before advice from 'X' (Doo.java:25)"/>
      </compile>
      <run class="Doo"/>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138158" title="not at withincode - 2">
      <compile files="Foo.java" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(void java.io.PrintStream.println(java.lang.String))' in Type 'Foo' (Foo.java:14) advised by before advice from 'X' (Foo.java:26)"/>
		<message kind="weave" text="Join point 'method-call(void java.io.PrintStream.println(java.lang.String))' in Type 'Foo' (Foo.java:18) advised by before advice from 'X' (Foo.java:23)"/>
      </compile>
      <run class="Foo"/>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137568" title="complicated generics declaration">
      <compile files="C.java" options="-emacssym -1.5"/>
      <run class="C"/>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138143" title="npe on duplicate method with ataj">
      <compile files="AspectClass.java" options="-1.5">
        <message kind="error" line="7" text="Duplicate method incomingMessage() in type AspectClass"/>
        <message kind="error" line="12" text="Duplicate method incomingMessage() in type AspectClass"/>
      </compile>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - B">
      <compile files="B.java" options="-1.5 -showWeaveInfo">
        <!--message kind="weave" text="Join point 'method-call(java.lang.String C.pm(java.lang.String))' in Type 'B' (B.java:20) advised by before advice from 'X' (B.java:26)"/-->
        <message kind="weave" text="Join point 'method-call(java.lang.Object C.pm(java.lang.Object))' in Type 'B' (B.java:20) advised by before advice from 'X' (B.java:26)"/>
        <!--message kind="weave" text="Join point 'method-call(java.lang.String C.pm2(java.lang.String))' in Type 'B' (B.java:21) advised by before advice from 'X' (B.java:27)"/-->
      </compile>
      <run class="B">
        <stderr>
          <line text="advice"/>
          <line text="foo"/>
        </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - D">
      <compile files="D.java" options="-1.5 -showWeaveInfo">
		<message kind="weave" text="Join point 'method-call(java.lang.String CImpl.pm(java.lang.String))' in Type 'D' (D.java:20) advised by before advice from 'X' (D.java:26)"/>
		<message kind="weave" text="Join point 'method-call(java.lang.String CImpl.pm2(java.lang.String))' in Type 'D' (D.java:21) advised by before advice from 'X' (D.java:27)"/>
      </compile>
      <run class="D">
        <stderr>
          <line text="advice"/>
          <line text="foo"/>
          <line text="advice2"/>
          <line text="foo"/>
        </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - E">
      <compile files="E.java" options="-1.5 -showWeaveInfo">
      	<message kind="weave" text="Join point 'method-call(java.lang.Object C.pm(java.lang.Object))' in Type 'E' (E.java:18) advised by before advice from 'X' (E.java:23)"/>
      </compile>
      <run class="E">
        <stderr>
          <line text="advice"/>
          <line text="foo"/>
        </stderr>
      </run>
    </ajc-test>
    
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - F">
      <compile files="F.java" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(java.lang.Object C.pm(java.lang.Object))' in Type 'F' (F.java:18) advised by before advice from 'X' (F.java:23)"/>
      </compile>
      <run class="F">
        <stderr>
          <line text="advice"/>
          <line text="foo"/>
        </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - G">
      <compile files="G.java" options="-1.5 -showWeaveInfo">
        <message kind="warning" line="23" text="advice defined in X has not been applied [Xlint:adviceDidNotMatch]"/>
      </compile>
      <run class="G">
        <stderr>
          <line text="foo"/>
        </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/binaryDecp" title="incorrect overrides evaluation - 1.3">
      <compile files="SubClassLoader.java,SubSubClassLoader.java" options="-1.3" outjar="lib.jar"/>
      <compile files="X.aj" inpath="lib.jar" options="-showWeaveInfo">
        <message kind="weave" text="Setting superclass of type 'SubSubClassLoader' (SubSubClassLoader.java) to 'SubClassLoader' (X.aj)"/>
      </compile>
    </ajc-test>
    
    <ajc-test dir="bugs152/binaryDecp" title="incorrect overrides evaluation - 1.5">
      <compile files="SubClassLoader.java,SubSubClassLoader.java" options="-1.5" outjar="lib.jar"/>
      <compile files="X.aj" inpath="lib.jar" options="-showWeaveInfo">
        <message kind="weave" text="Setting superclass of type 'SubSubClassLoader' (SubSubClassLoader.java) to 'SubClassLoader' (X.aj)"/>
      </compile>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138215" pr="138215" title="Reference pointcut fails inside @DeclareWarning">
      <compile files="pr138215.aj" options="-1.5">
        <message kind="warning" line="17" text="no foos please"/>
      </compile>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138219" pr="138219" title="Can't use a FQ Reference pointcut in any pointcut expression referenced by a per-clause">
      <compile files="PerThisWithReference.aj,SomeOtherType.aj" options="-1.5">
      </compile>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138220" pr="138220" title="@Aspect with reference pointcut in perclause">
      <compile files="AtAspectWithPerClause.aj" options="-1.5">
      </compile>
    </ajc-test>

    <ajc-test dir="bugs152/pr138223" pr="138223" title="Double at annotation matching (no binding)">
      <compile files="DoubleAnnotationMatching.aj" options="-1.5">
      </compile>
    </ajc-test>

</suite>
<!DOCTYPE suite SYSTEM "../tests/ajcTestSuite.dtd"[]>

<!-- AspectJ v1.5.2 Tests -->
<suite>

    <ajc-test dir="bugs152/pr135001" title="aspect libraries and asm">
      <compile files="AbstractAspect.java" outjar="lib.jar" options="-1.5"/>
      <compile files="Foo.java,ConcreteAspect.java" classpath="lib.jar" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(void Foo.foo())' in Type 'Foo' (Foo.java:3) advised by around advice from 'ConcreteAspect' (AbstractAspect.java:5)"/>
      </compile>
      <run class="Foo">
         <stderr>
           <line text="In the advice!"/>
         </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr136258" title="stack overflow">
      <compile files="StatisticsTypeImpl.java" options="-1.5"/>
      <run class="StatisticsTypeImpl"/>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138384" title="method too big">
      <compile files="BigMethod.java" options="-1.5"> <!-- will be 67628 bytes in the big method -->
        <message kind="error" line="1" text="problem generating method BigMethod.i_am_a_big_method : Code size too big: 67629"/>
      </compile>
      <!--run class="BigMethod"/-->
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138798" title="atWithinCodeBug">
      <compile files="ErrorHandling.aj" options="-1.5"/>
      <run class="ErrorHandling">
         <stderr>
           <line text="Caught in foo"/>
         </stderr>
      </run>      
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138158" title="not at withincode - 1">
      <compile files="Boo.java" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(void Boo.m())' in Type 'Boo' (Boo.java:9) advised by before advice from 'X' (Boo.java:19)"/>
      </compile>
      <run class="Boo"/>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138158" title="not at within - 3">
      <compile files="Doo.java" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(void java.io.PrintStream.println(java.lang.String))' in Type 'Soo' (Doo.java:20) advised by before advice from 'X' (Doo.java:25)"/>
      </compile>
      <run class="Doo"/>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138158" title="not at withincode - 2">
      <compile files="Foo.java" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(void java.io.PrintStream.println(java.lang.String))' in Type 'Foo' (Foo.java:14) advised by before advice from 'X' (Foo.java:26)"/>
		<message kind="weave" text="Join point 'method-call(void java.io.PrintStream.println(java.lang.String))' in Type 'Foo' (Foo.java:18) advised by before advice from 'X' (Foo.java:23)"/>
      </compile>
      <run class="Foo"/>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137568" title="complicated generics declaration">
      <compile files="C.java" options="-emacssym -1.5"/>
      <run class="C"/>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138143" title="npe on duplicate method with ataj">
      <compile files="AspectClass.java" options="-1.5">
        <message kind="error" line="7" text="Duplicate method incomingMessage() in type AspectClass"/>
        <message kind="error" line="12" text="Duplicate method incomingMessage() in type AspectClass"/>
      </compile>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - B">
      <compile files="B.java" options="-1.5 -showWeaveInfo">
        <!--message kind="weave" text="Join point 'method-call(java.lang.String C.pm(java.lang.String))' in Type 'B' (B.java:20) advised by before advice from 'X' (B.java:26)"/-->
        <message kind="weave" text="Join point 'method-call(java.lang.Object C.pm(java.lang.Object))' in Type 'B' (B.java:20) advised by before advice from 'X' (B.java:26)"/>
        <!--message kind="weave" text="Join point 'method-call(java.lang.String C.pm2(java.lang.String))' in Type 'B' (B.java:21) advised by before advice from 'X' (B.java:27)"/-->
      </compile>
      <run class="B">
        <stderr>
          <line text="advice"/>
          <line text="foo"/>
        </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - D">
      <compile files="D.java" options="-1.5 -showWeaveInfo">
		<message kind="weave" text="Join point 'method-call(java.lang.String CImpl.pm(java.lang.String))' in Type 'D' (D.java:20) advised by before advice from 'X' (D.java:26)"/>
		<message kind="weave" text="Join point 'method-call(java.lang.String CImpl.pm2(java.lang.String))' in Type 'D' (D.java:21) advised by before advice from 'X' (D.java:27)"/>
      </compile>
      <run class="D">
        <stderr>
          <line text="advice"/>
          <line text="foo"/>
          <line text="advice2"/>
          <line text="foo"/>
        </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - E">
      <compile files="E.java" options="-1.5 -showWeaveInfo">
      	<message kind="weave" text="Join point 'method-call(java.lang.Object C.pm(java.lang.Object))' in Type 'E' (E.java:18) advised by before advice from 'X' (E.java:23)"/>
      </compile>
      <run class="E">
        <stderr>
          <line text="advice"/>
          <line text="foo"/>
        </stderr>
      </run>
    </ajc-test>
    
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - F">
      <compile files="F.java" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(java.lang.Object C.pm(java.lang.Object))' in Type 'F' (F.java:18) advised by before advice from 'X' (F.java:23)"/>
      </compile>
      <run class="F">
        <stderr>
          <line text="advice"/>
          <line text="foo"/>
        </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - G">
      <compile files="G.java" options="-1.5 -showWeaveInfo">
        <message kind="warning" line="23" text="advice defined in X has not been applied [Xlint:adviceDidNotMatch]"/>
      </compile>
      <run class="G">
        <stderr>
          <line text="foo"/>
        </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137496" title="pointcuts and generics - H">
      <compile files="H.java" options="-1.5 -showWeaveInfo">
        <message kind="weave" text="Join point 'method-call(java.lang.Object C.pm(java.lang.Object))' in Type 'H' (H.java:20) advised by around advice from 'X' (H.java:26)"/>
      </compile>
      <run class="H">
        <stderr>
          <line text="advice"/>
        </stderr>
      </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/binaryDecp" title="incorrect overrides evaluation - 1.3">
      <compile files="SubClassLoader.java,SubSubClassLoader.java" options="-1.3" outjar="lib.jar"/>
      <compile files="X.aj" inpath="lib.jar" options="-showWeaveInfo">
        <message kind="weave" text="Setting superclass of type 'SubSubClassLoader' (SubSubClassLoader.java) to 'SubClassLoader' (X.aj)"/>
      </compile>
    </ajc-test>
    
    <ajc-test dir="bugs152/binaryDecp" title="incorrect overrides evaluation - 1.5">
      <compile files="SubClassLoader.java,SubSubClassLoader.java" options="-1.5" outjar="lib.jar"/>
      <compile files="X.aj" inpath="lib.jar" options="-showWeaveInfo">
        <message kind="weave" text="Setting superclass of type 'SubSubClassLoader' (SubSubClassLoader.java) to 'SubClassLoader' (X.aj)"/>
      </compile>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138215" pr="138215" title="Reference pointcut fails inside @DeclareWarning">
      <compile files="pr138215.aj" options="-1.5">
        <message kind="warning" line="17" text="no foos please"/>
      </compile>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138219" pr="138219" title="Can't use a FQ Reference pointcut in any pointcut expression referenced by a per-clause">
      <compile files="PerThisWithReference.aj,SomeOtherType.aj" options="-1.5">
      </compile>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr138220" pr="138220" title="@Aspect with reference pointcut in perclause">
      <compile files="AtAspectWithPerClause.aj" options="-1.5">
      </compile>
    </ajc-test>

    <ajc-test dir="bugs152/pr138223" pr="138223" title="Double at annotation matching (no binding)">
      <compile files="DoubleAnnotationMatching.aj" options="-1.5">
      </compile>
    </ajc-test>

    <ajc-test dir="bugs152/pr138286" pr="138286" title="No ClassCastException with perThis">
      <compile files="A.aj" options="-1.5 -showWeaveInfo">      
	    <message kind="weave" text="Join point 'initialization(void A.&lt;init&gt;())' in Type 'A' (A.aj:9) advised by before advice from 'A' (A.aj:13) [with runtime test]"/>
	    <message kind="weave" text="Join point 'initialization(void Soo.&lt;init&gt;())' in Type 'Soo' (A.aj:31) advised by before advice from 'A' (A.aj:13) [with runtime test]"/>
	    <message kind="weave" text="Join point 'initialization(void Goo.&lt;init&gt;())' in Type 'Goo' (A.aj:27) advised by before advice from 'A' (A.aj:13) [with runtime test]"/>
	    <message kind="weave" text="Join point 'initialization(void Foo.&lt;init&gt;())' in Type 'Foo' (A.aj:25) advised by before advice from 'A' (A.aj:13) [with runtime test]"/>
	    <message kind="weave" text="Join point 'initialization(void Boo.&lt;init&gt;())' in Type 'Boo' (A.aj:29) advised by before advice from 'A' (A.aj:13) [with runtime test]"/>
      </compile>
      <run class="A">
        <stderr>
          <line text="class Foo"/>
          <line text="class Boo"/>
          <line text="class Boo"/> <!-- this one is because of the super() call in Soo's default ctor -->
          <line text="class Soo"/>
        </stderr>
      </run>
    </ajc-test>

	<ajc-test dir="bugs152/pr139749" pr="139749" title="Super calls in @AspectJ advice">
	  <compile files="AroundAdvicePassingPjpAsArgToSuper.java" options="-1.5">
	  </compile>
	  <run class="a.b.c.AroundAdvicePassingPjpAsArgToSuper"/>
	</ajc-test>
	
	  <ajc-test dir="bugs152/pr137235"  pr="137235"
		title="directory with .jar extension: source and outjar">
	    <compile files="directory.jar/Hello.java" outjar="directory.jar/run.custom"/>
        <run class="Hello" classpath="$sandbox/directory.jar/run.custom">
          <stdout>
            <line text="Hello Java"/>
          </stdout>
        </run>
    </ajc-test>
    
    <ajc-test dir="bugs152/pr137235"  pr="137235"
		title="directory with .jar extension"  >
	    <compile files="directory.jar/Before.java" outjar="directory.jar/inOne.custom"/>
	    <compile files="directory.jar/BeforeExec.aj" outjar="directory.jar/inTwo"/>
	    <compile files="directory.jar/Rename.aj" outjar="directory.jar/weave.jar"/>
	    <compile files="directory.jar/Hello.java" inpath="directory.jar/inOne.custom,directory.jar/inTwo" aspectpath="directory.jar/weave.jar" outjar="directory.jar/outJar.jar"/>
        <run class="Hello" classpath="$sandbox/directory.jar/outJar.jar,$sandbox/directory.jar/weave.jar">
          <stdout>
            <line text="Before call"/>
            <line text="Before execution"/>
            <line text="Hello AspectJ not just Java"/>
          </stdout>
        </run>
    </ajc-test>
    
	<ajc-test dir="bugs152/pr136393" title="NPE in makePreMethod">
	  <compile files="World.aj" options="-1.5">
  	    <message kind="warning" line="10" text="this affected type is not exposed to the weaver: java.lang.String [Xlint:typeNotExposedToWeaver]"/>
	    <message kind="error" line="11" text="h cannot be resolved"/>
	    <message kind="error" line="16" text="Stystems cannot be resolved"/>
	  </compile>
	</ajc-test>
</suite>